### ä»£ç è¯„å®¡æŠ¥å‘Š

#### 1. **GitHub Actions å·¥ä½œæµå˜æ›´**
**å˜æ›´å†…å®¹**ï¼š
```diff
+        env:
+          GITHUB_TOKEN: ${{ secrets.CODE_TOKEN }}
```
**è¯„å®¡æ„è§**ï¼š
- âœ… **å®‰å…¨æ”¹è¿›**ï¼šé€šè¿‡ GitHub Secrets æ³¨å…¥ `CODE_TOKEN`ï¼Œé¿å…ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯ï¼Œç¬¦åˆå®‰å…¨æœ€ä½³å®è·µã€‚
- âš ï¸ **æƒé™å»ºè®®**ï¼šç¡®ä¿ `CODE_TOKEN` å…·æœ‰ `repo` å’Œ `workflow` æƒé™ï¼Œå¦åˆ™åç»­ Git æ“ä½œä¼šå¤±è´¥ã€‚
- ğŸ” **å‘½åå»ºè®®**ï¼šå»ºè®®å°† `CODE_TOKEN` é‡å‘½åä¸ºæ›´æ˜ç¡®çš„åç§°ï¼ˆå¦‚ `GH_PAT_TOKEN`ï¼‰ï¼Œé¿å…ä¸ GitHub å†…ç½®çš„ `GITHUB_TOKEN` æ··æ·†ã€‚

---

#### 2. **OpenAiCodeReview.java æ ¸å¿ƒå˜æ›´**

##### 2.1 **ç¯å¢ƒå˜é‡æ ¡éªŒ**
```java
String githubToken = System.getenv("GITHUB_TOKEN");
if (githubToken == null || githubToken.isEmpty()) {
    throw new IllegalArgumentException("GITHUB_TOKENç¯å¢ƒå˜é‡æœªè®¾ç½®");
}
```
**è¯„å®¡æ„è§**ï¼š
- âœ… **å¥å£®æ€§å¢å¼º**ï¼šæ˜¾å¼æ ¡éªŒå¿…éœ€çš„ç¯å¢ƒå˜é‡ï¼Œé¿å…è¿è¡Œæ—¶ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚
- âš ï¸ **é”™è¯¯æç¤º**ï¼šå»ºè®®åœ¨å¼‚å¸¸ä¿¡æ¯ä¸­åŒ…å«è§£å†³æ–¹æ¡ˆï¼ˆå¦‚â€œè¯·åœ¨ GitHub Secrets ä¸­é…ç½® CODE_TOKENâ€ï¼‰ã€‚

##### 2.2 **Git Diff å¤„ç†**
```java
ProcessBuilder processBuilder = new ProcessBuilder("git", "diff", "HEAD~1", "HEAD");
```
**è¯„å®¡æ„è§**ï¼š
- âŒ **èŒƒå›´é™åˆ¶**ï¼šç¡¬ç¼–ç  `HEAD~1..HEAD` åªèƒ½è¯„å®¡æœ€è¿‘ä¸€æ¬¡æäº¤ï¼Œæ— æ³•å¤„ç† Pull Request æˆ–å¤šæäº¤åœºæ™¯ã€‚  
  **å»ºè®®**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡åŠ¨æ€ä¼ å…¥æ¯”è¾ƒèŒƒå›´ï¼ˆå¦‚ `${{ github.event.before }}..${{ github.sha }}`ï¼‰ã€‚
- âš ï¸ **é”™è¯¯å¤„ç†ç¼ºå¤±**ï¼šæœªå¤„ç† `git diff` å‘½ä»¤å¤±è´¥çš„æƒ…å†µï¼ˆå¦‚é Git ä»“åº“ç¯å¢ƒï¼‰ã€‚  
  **å»ºè®®**ï¼šæ£€æŸ¥è¿›ç¨‹é€€å‡ºç ï¼Œæ•è·å¼‚å¸¸å¹¶è¾“å‡ºå‹å¥½é”™è¯¯ã€‚

##### 2.3 **AI ä»£ç è¯„å®¡æ¥å£**
**é—®é¢˜ç‚¹**ï¼š
1. **API å¯†é’¥ç¡¬ç¼–ç **ï¼š
   ```java
   String apiKey = "655c244927a04b70b3e852685f808e76.lY208DcifC1UpPAe";
   ```
   - âŒ **ä¸¥é‡å®‰å…¨é£é™©**ï¼šå¯†é’¥ç›´æ¥æš´éœ²åœ¨ä»£ç ä¸­ï¼Œå¯èƒ½å¯¼è‡´ API æ»¥ç”¨å’Œè´¹ç”¨æŸå¤±ã€‚  
     **ä¿®å¤æ–¹æ¡ˆ**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥ï¼ˆå¦‚ `OPENAI_API_KEY`ï¼‰ã€‚

2. **è¶…æ—¶è®¾ç½®**ï¼š
   ```java
   .connectTimeout(5, TimeUnit.MINUTES)
   ```
   - âœ… **åˆç†æ€§**ï¼š5 åˆ†é’Ÿè¶…æ—¶é€‚åˆå¤æ‚ä»£ç è¯„å®¡åœºæ™¯ï¼Œä½†éœ€æ³¨æ„ï¼š
     - è‹¥é¢‘ç¹è¶…æ—¶ï¼Œå»ºè®®æ·»åŠ é‡è¯•æœºåˆ¶ï¼ˆå¦‚æŒ‡æ•°é€€é¿ï¼‰ã€‚
     - è€ƒè™‘å°†è¶…æ—¶æ—¶é—´é…ç½®åŒ–ï¼ˆé€šè¿‡ç¯å¢ƒå˜é‡ï¼‰ã€‚

3. **æ¨¡å‹é€‰æ‹©**ï¼š
   ```java
   requestMap.put("model", "glm-4.5");
   ```
   - âš ï¸ **ç‰ˆæœ¬é£é™©**ï¼š`glm-4.5` å¯èƒ½æ˜¯å®éªŒæ€§ç‰ˆæœ¬ï¼Œéœ€ç¡®è®¤å…¶ç¨³å®šæ€§ã€‚  
     **å»ºè®®**ï¼šä½¿ç”¨ç¨³å®šç‰ˆæœ¬ï¼ˆå¦‚ `glm-4`ï¼‰ï¼Œæˆ–é€šè¿‡é…ç½®æ–‡ä»¶åŠ¨æ€æŒ‡å®šæ¨¡å‹ã€‚

##### 2.4 **æ—¥å¿—å†™å…¥ Git ä»“åº“**
```java
private static String writeLog(String token, String log) throws GitAPIException, IOException {
    Git git = Git.cloneRepository()
        .setURI("https://github.com/ChanYanny/openai-code-review-log.git")
        .setDirectory(new File("repo"))
        .setCredentialsProvider(new UsernamePasswordCredentialsProvider(token, ""))
        .call();
    // ... å†™å…¥æ–‡ä»¶ã€æäº¤ã€æ¨é€ ...
}
```
**è¯„å®¡æ„è§**ï¼š
- âœ… **åŠŸèƒ½å®Œæ•´æ€§**ï¼šå®ç°æ—¥å¿—æŒä¹…åŒ–åˆ°ç‹¬ç«‹ä»“åº“ï¼Œä¾¿äºå®¡è®¡å’Œè¿½è¸ªã€‚
- âŒ **å…³é”®ç¼ºé™·**ï¼š
  1. **ç¡¬ç¼–ç ä»“åº“åœ°å€**ï¼š`setURI("https://github.com/ChanYanny/openai-code-review-log.git")` é™åˆ¶äº†çµæ´»æ€§ã€‚  
     **ä¿®å¤**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®ç›®æ ‡ä»“åº“ï¼ˆå¦‚ `LOG_REPO_URL`ï¼‰ã€‚
  2. **ç›®å½•å†²çªé£é™©**ï¼šæ‰€æœ‰ä»»åŠ¡å…±äº« `repo` ç›®å½•ï¼Œå¹¶å‘æ‰§è¡Œæ—¶å¯èƒ½å†²çªã€‚  
     **ä¿®å¤**ï¼šä¸ºæ¯æ¬¡ä»»åŠ¡ç”Ÿæˆå”¯ä¸€ä¸´æ—¶ç›®å½•ï¼ˆå¦‚ `repo_${UUID}`ï¼‰ã€‚
  3. **èµ„æºæ³„æ¼**ï¼šæœªå…³é—­ `Git` å¯¹è±¡ï¼Œå¯èƒ½å¯¼è‡´æ–‡ä»¶å¥æŸ„æ³„æ¼ã€‚  
     **ä¿®å¤**ï¼šåœ¨ `finally` å—ä¸­è°ƒç”¨ `git.close()`ã€‚
- âš ï¸ **æ€§èƒ½é—®é¢˜**ï¼š
  - æ¯æ¬¡å…¨é‡å…‹éš†ä»“åº“ï¼ˆå³ä½¿ä»…æ·»åŠ å°æ–‡ä»¶ï¼‰ï¼Œæ•ˆç‡ä½ä¸‹ã€‚  
    **ä¼˜åŒ–**ï¼šä½¿ç”¨æµ…å…‹éš†ï¼ˆ`.setDepth(1)`ï¼‰ã€‚
  - éšæœºæ–‡ä»¶åï¼ˆ`generateRandomString(12) + ".md"`ï¼‰æ— æ³•å…³è”åˆ°å…·ä½“ä»£ç æäº¤ã€‚  
    **ä¼˜åŒ–**ï¼šæ–‡ä»¶ååŒ…å«ä¸Šä¸‹æ–‡ï¼ˆå¦‚ `${repoName}_${commitHash}.md`ï¼‰ã€‚
- ğŸ”’ **æƒé™è¦æ±‚**ï¼š`CODE_TOKEN` éœ€æœ‰ç›®æ ‡ä»“åº“çš„å†™å…¥æƒé™ï¼Œéœ€åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ã€‚

##### 2.5 **è¾…åŠ©æ–¹æ³•**
```java
private static String generateRandomString(int length) {
    String characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    // ... ç”Ÿæˆéšæœºå­—ç¬¦ä¸² ...
}
```
**è¯„å®¡æ„è§**ï¼š
- âœ… **å®ç°æ­£ç¡®**ï¼šæ»¡è¶³åŸºæœ¬éœ€æ±‚ã€‚
- âš ï¸ **å®‰å…¨æ€§**ï¼š`Random` éåŠ å¯†å®‰å…¨ï¼Œä½†æ–‡ä»¶ååœºæ™¯å¯æ¥å—ã€‚è‹¥éœ€æ›´é«˜å®‰å…¨æ€§ï¼Œæ”¹ç”¨ `SecureRandom`ã€‚

---

### 3. **æ¶æ„è®¾è®¡å»ºè®®**
#### 3.1 **é…ç½®å¤–éƒ¨åŒ–**
- **é—®é¢˜**ï¼šç¡¬ç¼–ç å€¼ï¼ˆAPI å¯†é’¥ã€ä»“åº“åœ°å€ã€æ¨¡å‹åç§°ï¼‰é™ä½å¯ç»´æŠ¤æ€§ã€‚
- **æ–¹æ¡ˆ**ï¼š
  ```yaml
  # GitHub Actions ä¸­æ³¨å…¥é…ç½®
  env:
    OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
    LOG_REPO_URL: "https://github.com/ChanYanny/openai-code-review-log.git"
    AI_MODEL: "glm-4"
  ```

#### 3.2 **é”™è¯¯å¤„ç†å¢å¼º**
- **å½“å‰é—®é¢˜**ï¼šå¼‚å¸¸ç›´æ¥æŠ›å‡ºï¼Œå¯¼è‡´ GitHub Actions å¤±è´¥ä½†æ— æ¸…æ™°æ—¥å¿—ã€‚
- **æ”¹è¿›æ–¹æ¡ˆ**ï¼š
  ```java
  try {
      String log = codeReview(diffCode.toString());
      String logUrl = writeLog(githubToken, log);
      System.out.println("è¯„å®¡æ—¥å¿—URLï¼š" + logUrl);
  } catch (Exception e) {
      System.err.println("ä»£ç è¯„å®¡å¤±è´¥: " + e.getMessage());
      e.printStackTrace();
      System.exit(1); // æ˜ç¡®æ ‡è®°å¤±è´¥
  }
  ```

#### 3.3 **å¹¶å‘ä¸èµ„æºç®¡ç†**
- **é—®é¢˜**ï¼šå¤šä»»åŠ¡åŒæ—¶è¿è¡Œæ—¶ï¼Œç›®å½•å†²çªå’Œèµ„æºæ³„æ¼ã€‚
- **æ–¹æ¡ˆ**ï¼š
  ```java
  File tempDir = Files.createTempDirectory("code_review_").toFile();
  try {
      Git git = Git.cloneRepository()
          .setDirectory(tempDir)
          .setDepth(1) // æµ…å…‹éš†
          .call();
      // ... æ‰§è¡Œæ“ä½œ ...
  } finally {
      git.close();
      FileUtils.deleteDirectory(tempDir); // æ¸…ç†ä¸´æ—¶ç›®å½•
  }
  ```

---

### 4. **å®‰å…¨ä¸åˆè§„**
| é£é™©é¡¹                | ä¸¥é‡æ€§ | ä¿®å¤æ–¹æ¡ˆ                          |
|-----------------------|--------|-----------------------------------|
| API å¯†é’¥ç¡¬ç¼–ç         | ğŸ”´ é«˜   | é€šè¿‡ç¯å¢ƒå˜é‡æ³¨å…¥                  |
| ä»“åº“åœ°å€ç¡¬ç¼–ç         | ğŸŸ¡ ä¸­   | é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®                  |
| Token æƒé™æœªæ˜ç¡®      | ğŸŸ¡ ä¸­   | æ–‡æ¡£è¯´æ˜æ‰€éœ€æƒé™ï¼ˆ`repo`/`workflow`ï¼‰ |
| ä¸´æ—¶ç›®å½•æœªæ¸…ç†        | ğŸŸ  ä½   | ä½¿ç”¨ `try-finally` ç¡®ä¿æ¸…ç†      |

---

### 5. **æ€»ç»“**
**ä¼˜ç‚¹**ï¼š
- å®ç°äº†ç«¯åˆ°ç«¯çš„è‡ªåŠ¨åŒ–ä»£ç è¯„å®¡æµç¨‹ï¼ˆGit Diff â†’ AI åˆ†æ â†’ æ—¥å¿—æŒä¹…åŒ–ï¼‰ã€‚
- é€šè¿‡ GitHub Secrets ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œç¬¦åˆå®‰å…¨åŸºç¡€è¦æ±‚ã€‚

**å…³é”®æ”¹è¿›ç‚¹**ï¼š
1. **ç«‹å³ä¿®å¤**ï¼šç§»é™¤ç¡¬ç¼–ç çš„ API å¯†é’¥å’Œä»“åº“åœ°å€ï¼Œæ”¹ç”¨ç¯å¢ƒå˜é‡ã€‚
2. **å¢å¼ºå¥å£®æ€§**ï¼šæ·»åŠ é”™è¯¯å¤„ç†ã€èµ„æºæ¸…ç†å’Œå¹¶å‘æ§åˆ¶ã€‚
3. **æå‡å¯ç»´æŠ¤æ€§**ï¼šå°†é…ç½®ï¼ˆæ¨¡å‹ã€è¶…æ—¶ã€ä»“åº“ï¼‰å¤–éƒ¨åŒ–ã€‚
4. **ä¼˜åŒ–æ€§èƒ½**ï¼šä½¿ç”¨æµ…å…‹éš†å’Œä¸Šä¸‹æ–‡åŒ–æ–‡ä»¶åã€‚

**æ¨èä¼˜å…ˆçº§**ï¼š  
ğŸ”´ **é«˜**ï¼šä¿®å¤å®‰å…¨é£é™©ï¼ˆAPI å¯†é’¥ï¼‰  
ğŸŸ¡ **ä¸­**ï¼šè§£å†³å¹¶å‘å’Œèµ„æºæ³„æ¼é—®é¢˜  
ğŸŸ¢ **ä½**ï¼šä¼˜åŒ–æ—¥å¿—æ–‡ä»¶å‘½åå’Œé”™è¯¯æç¤º  

> **å»ºè®®åç»­æ­¥éª¤**ï¼š  
> 1. åœ¨ GitHub Secrets ä¸­æ·»åŠ  `OPENAI_API_KEY` å’Œ `LOG_REPO_URL`ã€‚  
> 2. ä½¿ç”¨ `try-with-resources` æˆ– `finally` ç¡®ä¿ `Git` å¯¹è±¡å…³é—­ã€‚  
> 3. ä¸ºæ–‡ä»¶åæ·»åŠ æäº¤å“ˆå¸Œå‰ç¼€ï¼ˆå¦‚ `${commitHash}_review.md`ï¼‰ã€‚